processor_resources:
  - label: "{package}_0a65cfcb5cd4d65a"
    hp_transform:
      name: "Prepare Update Data"
      input: |-
            root = this
      mapping: |-
            root = this
            let updatedTransTimes = this.aft.transTimes + 1
            root.transTimes = $updatedTransTimes
            root.lastDate = now().ts_format("2006-01-02")
            root.nextDate = if this.aft.frequency == "M" && $updatedTransTimes < this.aft.totalTimes {
                this.nextDate
            } else {
                this.aft.nextDate
            }
            root.status = if this.aft.frequency == "O" || (this.aft.frequency == "M" && $updatedTransTimes == this.aft.totalTimes) {
                "C"
            } else {
                "A"
            }
            root.updatedDateTime = now().ts_format("2006-01-02 15:04:05")
            
      result_mode: merge
      output: |-
            root = this
