processor_resources:
  - label: "{package}_030e93a879bcc989"
    hp_transform:
      name: "Get Total Times"
      input: |-
            root = this
      mapping: |-
            root = this
            root = this
            let current = now().ts_format("2006-01-02")
            let start = this.frequency.dateStart
            let end = this.frequency.dateEnd
            let payment_day = this.frequency.days.number()
            let arr = [$current, $start, this.nextDate]
            let current = $arr.sort().index(-1)
                    
            let current_year = $current.ts_parse("2006-01-02").ts_format("2006")
            let current_month = $current.ts_parse("2006-01-02").ts_format("01")
            let current_day = $current.ts_parse("2006-01-02").ts_format("02")
            
            let end_year = $end.ts_parse("2006-01-02").ts_format("2006")
            let end_month = $end.ts_parse("2006-01-02").ts_format("01")
            let remaining_months = (($end_year.number() - $current_year.number()) * 12 + ($end_month.number() - $current_month.number()) + 1)
            
            root.totalTimes = $remaining_months.number()
      result_mode: merge
      output: |-
            root = this
