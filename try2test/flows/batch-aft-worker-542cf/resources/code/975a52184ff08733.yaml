processor_resources:
  - label: "{package}_975a52184ff08733"
    hp_transform:
      name: "Make tso"
      input: |-
            root = this
      mapping: |-
            root = this
            let tso_lst = if this.dtl.index(9) != null && this.dtl.index(9) != "" {
                this.dtl.index(9).split("~").or([])
            } else {
                []
            }
            
            let value_dat = this.trans.prepare.trans.creditor.info.transaction.rrn
            let tso_lst = if value_dat != null &&  value_dat != "" {
                $tso_lst.append("ZRRN#" + value_dat)
            } else {
                $so_lst
            }
            
            let value_dat = this.trans.prepare.trans.creditor.info.promptpay.toBankCode
            let tso_lst = if value_dat != null &&  value_dat != "" {
                $tso_lst.append("ZTOBNK#" + value_dat)
            } else {
                $tso_lst
            }
            
            let value_dat = this.trans.prepare.trans.creditor.info.promptpay.toAcctNo
            let tso_lst = if value_dat != null &&  value_dat != "" {
                $tso_lst.append("ZTOACC#" + value_dat)
            } else {
                $tso_lst
            }
            
            let tso = if $tso_lst.length() > 0 {
                $tso_lst.join("~")
            } else {
                ""
            }
            
            root.tso = if this.own_inst == false {
                $tso
            }else {
                this.dtl.index(9)
            }
            
      result_mode: merge
      output: |-
            root = this
