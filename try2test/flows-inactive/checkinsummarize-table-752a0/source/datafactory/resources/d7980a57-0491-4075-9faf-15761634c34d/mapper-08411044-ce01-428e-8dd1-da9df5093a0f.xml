<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="techberry.msa.springboot.mapper.DataFactoryMapper">

    
    
	<!-- Statement Show employee leaves -->
	<select id="7c9e87b5-7447-4e98-91cc-54a5e9f4c50c" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
                "typeOfLeave"."typeName",
                "startDate",
                "endDate",
                "startTime",
                "endTime",
                "user"."firstname" || ' ' || "user"."lastname" as "fullname",
                "user"."nickname",
                "user"."image",
                "leaveRequest"."leaveID"
            from "leaveRequest"
            inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
            inner join "user" on "user"."username" = "leaveRequest"."username"
            inner join "leaveStatus" on "leaveRequest"."leaveID" = "leaveStatus"."leaveID"
            where
            (
                (to_date("startDate", 'DD/MM/YYYY') <= to_date(#{filterTo}, 'MM/DD/YYYY') AND
                to_date("endDate", 'DD/MM/YYYY') >= to_date(#{filterFrom}, 'MM/DD/YYYY'))
            OR
                (to_date(#{filterFrom}, 'MM/DD/YYYY') <= to_date("endDate", 'DD/MM/YYYY') AND
                to_date(#{filterTo}, 'MM/DD/YYYY') >= to_date("startDate", 'DD/MM/YYYY'))
            )

            AND

            (
            "leaveStatus" != 'deleted' 
            AND 
            "leaveStatus" != 'rejected'
            )
            AND NOT EXISTS (
            SELECT 1
            FROM "cancelLeave"
            WHERE "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
            AND "cancelLeave"."status" = 'cancelled'
        )

            AND
            "user"."isActive" = 'true'
           
            
            order by "firstname"
		]]>
	</select>
    
    
    
	<!-- Statement Show employee leaves_Get weekly filter -->
	<select id="ed430f40-b38a-4dfd-be3a-7bb71a3ed87d" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
  TO_CHAR(current_date, 'MM/DD/YYYY') AS today,
  TO_CHAR(date_trunc('week', current_date), 'MM/DD/YYYY') AS filterFrom,
  TO_CHAR(date_trunc('week', current_date) + '4 days'::interval, 'MM/DD/YYYY') AS filterTo;
		]]>
	</select>
    
    
    
	<!-- Statement Show employee leaves_Get monthly filter -->
	<select id="76fc6955-c431-49a0-a6d6-4ab6a2abf8aa" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
  TO_CHAR(current_date, 'MM/DD/YYYY') AS today,
  TO_CHAR(date_trunc('month', current_date), 'MM/DD/YYYY') AS filterFrom,
  TO_CHAR((date_trunc('month', current_date) + '1 month'::interval - '1 day'::interval), 'MM/DD/YYYY') AS filterTo;
		]]>
	</select>
    
    
    
	<!-- Statement Show employee leaves_withEmpName -->
	<select id="8db2e8d4-f22d-4785-b5bc-d182b4a3fc0c" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
                "typeOfLeave"."typeName",
                "startDate",
                "endDate",
                "startTime",
                "endTime",
                "user"."firstname" || ' ' || "user"."lastname" as "fullname",
                "user"."nickname",
                "user"."image",
                "leaveRequest"."leaveID"
            from "leaveRequest"
            inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
            inner join "user" on "user"."username" = "leaveRequest"."username"
            inner join "leaveStatus" on "leaveRequest"."leaveID" = "leaveStatus"."leaveID"
            where
            (
                (to_date("startDate", 'DD/MM/YYYY') <= to_date(#{filterTo}, 'MM/DD/YYYY') AND
                to_date("endDate", 'DD/MM/YYYY') >= to_date(#{filterFrom}, 'MM/DD/YYYY'))
            OR
                (to_date(#{filterFrom}, 'MM/DD/YYYY') <= to_date("endDate", 'DD/MM/YYYY') AND
                to_date(#{filterTo}, 'MM/DD/YYYY') >= to_date("startDate", 'DD/MM/YYYY'))
            )
            
            AND
            
            "leaveRequest"."username" = #{empName}

            AND
            (
            "leaveStatus" != 'deleted' 
            AND 
            "leaveStatus" != 'rejected'
            )
            
            AND NOT EXISTS (
            SELECT 1
            FROM "cancelLeave"
            WHERE "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
            AND "cancelLeave"."status" = 'cancelled'
        )

            AND
            "user"."isActive" = 'true'
            
            order by "firstname"
		]]>
	</select>
    
    
    
	<!-- Statement Load home screen_fields -->
	<select id="7e270f6c-a23a-4ba5-865a-9a3352a22658" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
    "firstname" || ' ' || "lastname" AS "fullname",
    "position",
    "remainingDays" || ' days '|| "remainingHours" || ' hours' AS "remaining",
    "image"
FROM "user"
INNER JOIN "remainingLeave" on "user"."username" = "remainingLeave"."username"
WHERE "user"."username" = #{username} AND "typeID" = 'LEAVE0001'; -- Vacation leave
		]]>
	</select>
    
    
    
	<!-- Statement Load home screen_table -->
	<select id="c44cecd5-b7e9-4c5c-bdde-2717f457cac6" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			    SELECT 
        "eventName",
        "eventDate" AS "startDate",
        "eventDate" AS "endDate",
        'Official holiday' as "eventType"
    FROM "officialHoliday"
    WHERE
        EXTRACT(month FROM TO_DATE("officialHoliday"."eventDate", 'DD/MM/YYYY')) = EXTRACT(month FROM CURRENT_DATE)
        AND
        EXTRACT(year FROM TO_DATE("officialHoliday"."eventDate", 'DD/MM/YYYY')) = EXTRACT(year FROM CURRENT_DATE)
    
    UNION
    
    SELECT 
        "typeOfLeave"."typeName",
        "leaveRequest"."startDate",
        "leaveRequest"."endDate",
        'Leave request' as "eventType"
    FROM "leaveRequest"
    INNER JOIN "typeOfLeave" ON "leaveRequest"."typeID" = "typeOfLeave"."typeID"
    INNER JOIN "leaveStatus" ON "leaveRequest"."leaveID" = "leaveStatus"."leaveID"
    WHERE 
        "leaveRequest"."username" = #{username}
        AND
        EXTRACT(month FROM TO_DATE("leaveRequest"."startDate", 'DD/MM/YYYY')) = EXTRACT(month FROM CURRENT_DATE)
        AND
        EXTRACT(year FROM TO_DATE("leaveRequest"."startDate", 'DD/MM/YYYY')) = EXTRACT(year FROM CURRENT_DATE)
        AND
        (
        "leaveStatus"."leaveStatus" != 'deleted' 
        AND 
        "leaveStatus"."leaveStatus" != 'rejected'
        )
        AND NOT EXISTS (
            SELECT 1
            FROM "cancelLeave"
            WHERE "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
            AND "cancelLeave"."status" = 'cancelled'
        )
ORDER BY "startDate";
		]]>
	</select>
    
    
    
	<!-- Statement Check_haveCheckIn -->
	<select id="56aaa8cb-f6db-4747-9fd7-499ca47aa807" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select "checkIn_time"
from "checkInRecord"
where "username" = #{username} and date("checkIn_time") = current_date
		]]>
	</select>
    
    
    
	<!-- Statement Do Login -->
	<select id="ce3de4a1-bd9f-4ca3-98e5-b8113fdbcbbd" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    "username", "isActive"
FROM "user"
WHERE "username" = #{username} and "password" = #{password}
		]]>
	</select>
    
    
    
	<!-- Statement Do Login_find PM -->
	<select id="53e21b21-ab87-48f2-b3d4-83329905b8c5" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select "supervisor"
from "empRelation"
where "supervisor" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Set notification ID_find -->
	<select id="61e91b68-45eb-4395-8f76-59f40bbe0a77" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select "notificationID" from "notification" where "username" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Set notification ID_insert -->
	<insert id="0c86340c-276a-4f98-9709-b246d5974641" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "notification"
        (
            "username",
            "notificationID"
        )
        VALUES
        (
            #{username},
            #{notificationID}
        )
		]]>
	</insert>
    
    
    
	<!-- Statement Set notification ID_update -->
	<update id="10e56679-c045-4af3-aebb-e3de426e5631" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "notification"
        SET "notificationID" = #{notificationID}
        WHERE "username" = #{username}
		]]>
	</update>
    
    
    
	<!-- Statement Show banner -->
	<select id="8ffb3aee-f264-44e6-b374-152343970959" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT * FROM "banner" ORDER BY "bannerOrder" ASC;
		]]>
	</select>
    
    
    
	<!-- Statement Get current date -->
	<select id="d54391c1-d1f4-4d83-9782-96b0cde21f9f" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
    CONCAT(
        TO_CHAR(current_timestamp AT TIME ZONE 'Asia/Bangkok', 'DD'), 
        ' ', 
        REPLACE(TO_CHAR(current_timestamp AT TIME ZONE 'Asia/Bangkok', 'Month'), ' ', ''),
        ' ', 
        TO_CHAR(current_timestamp AT TIME ZONE 'Asia/Bangkok', 'YYYY')
    ) AS "currentDate";

		]]>
	</select>
    
    
    
	<!-- Statement Load drop down employee name -->
	<select id="dc57c864-67a3-45f3-8526-8a39d514c535" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
    "username",
    "fullname"
FROM (
    SELECT 
        "username",
        "firstname" || ' ' || LEFT("lastname", 1) || '. (' || COALESCE("nickname", '') ||  ')' AS "fullname",
        1 AS "sort_order"
    FROM 
        "user"
    WHERE
    "user"."isActive" = 'true'
    UNION ALL
    SELECT 
        '' AS "username",
        'Show all' AS "fullname",
        0 AS "sort_order"
) AS sub

ORDER BY 
    "sort_order", 
    "fullname";
		]]>
	</select>
    
    
    
	<!-- Statement Show employee list_New -->
	<select id="1b4b530b-12cf-40c1-9203-c8f1f0b97e4f" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    *
FROM (
    SELECT
        CASE u."company"
            WHEN 'techberry' THEN 'TechBerry Co.,Ltd.'
            WHEN 'WDS' THEN 'WDS Co.,Ltd.'
            WHEN 'blueprint' THEN 'Blueprint Solutions Corporation Co.,Ltd.'
            WHEN 'BeeBuddy' THEN 'Beebuddy.Net Co.,Ltd.'
            ELSE u."company"
        END AS "company",
        u."firstname" || ' ' || u."lastname" AS "fullname",
        u."firstname" || ' ' || u."lastname" || ' (' || COALESCE(u."nickname", '') || ')' AS "employeeFullname",
        u."position",
        u."nickname",
        u."email",
        u."birthdate",
        u."firstday",
        u."mobile",
        u."staffID",
        u."fullAddress",
        u."image",
        u."username",
        COALESCE(NULLIF(er."supervisor",''),'-') as "supervisorName",
        CASE WHEN cr."checkIn_time" IS NOT NULL THEN 'true' ELSE 'false' END AS "hasCheckIn"
    FROM
        "user" u
    JOIN
        "empRelation" er ON u.username = er.supervisee
    LEFT JOIN
        "checkInRecord" cr ON u.username = cr.username AND DATE(cr."checkIn_time") = CURRENT_DATE
    WHERE
        u."isActive" = 'true'
        AND (
            #{username} = '' OR
            u."username" = #{username}
        )
) AS sub
ORDER BY
    ARRAY_POSITION(ARRAY['Wutichai Amornchaichan', 'Puttaporn Saengratanadej', 'Jon Vanasin', 'Verasak Jirathanakun', 'Tongsuk Buranarungruengkij'], "fullname") ASC,
    "fullname" ASC;

		]]>
	</select>
    
    
    
	<!-- Statement Show employee list_query_supervisorName -->
	<select id="e9336a88-e0f3-4e44-a258-37c9a58a8351" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "firstname" || ' ' || "lastname" AS "fullname" 
FROM "user" 
WHERE "username" = #{supervisorUsername}
		]]>
	</select>
    
    
    
	<!-- Statement Show user personal info -->
	<select id="6359578d-7bfb-4a01-aa5d-bdde13ea202e" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    CASE u."company"
        WHEN 'techberry' THEN 'TechBerry'
        WHEN 'WDS' THEN 'WDS'
        WHEN 'blueprint' THEN 'Blueprint'
        WHEN 'BeeBuddy' THEN 'Beebuddy'
        WHEN 'napkin' THEN 'Napkin'
        ELSE u."company"
    END AS "company",
    u."firstname" || ' ' || u."lastname" || ' (' || COALESCE(u."nickname", '') || ')' AS "fullname", -- Include nickname after lastname
    u."position",
    u."email",
    u."nickname",
    u."birthdate",
    u."firstday",
    u."mobile",
    u."staffID",
    u."fullAddress",
    su."firstname" || ' ' || su."lastname" AS "supervisor_fullname",
    su."mobile" AS "supervisor_mobile",  -- Include the supervisor's mobile number
    u."image",
    u."gender"
FROM
    "user" u
JOIN
    "empRelation" er ON u."username" = er."supervisee"
LEFT JOIN
    "user" su ON er."supervisor" = su."username"  -- Join with the user table again for supervisor's information
WHERE
    u."username" = #{username};
		]]>
	</select>
    
    
    
	<!-- Statement Show remaining leave profile_get allLeave -->
	<select id="7f06eedd-6863-40ab-bbe6-6f6fb1984f7f" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select distinct
        "typeID",
        "typeName"
    from "typeOfLeave"
		]]>
	</select>
    
    
    
	<!-- Statement Show remaining leave profile_get remaining -->
	<select id="c1a440b9-8b23-41ab-bb2e-8d7acd2de947" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    "remainingDays" || ' days ' || "remainingHours" || ' hours' AS "remaining",
    "usedDays" || ' days ' || "usedHours" || ' hours' AS "used",
    "totalDays" || ' days ' || "totalHours" || ' hours' AS "total"
FROM "remainingLeave"
WHERE 
    "username" = #{username}
    AND
    "typeID" = #{temp_typeID};

		]]>
	</select>
    
    
    
	<!-- Statement Load leave history_all -->
	<select id="5dadc9f0-77c5-4e0f-b7f3-cdff82aca1d1" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "attachedFile",
    "leaveDetail",
    "leaveStatus",
    "submittedTime"
from "leaveRequest"
inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
inner join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "username" = #{username}
    and
    "leaveStatus" != 'deleted'
    and
    "leaveRequest"."leaveID" NOT IN (
        SELECT "leaveID"
        FROM "cancelLeave"
        WHERE "status" <> 'rejected'
    )

UNION

SELECT
    "cancelLeave"."leaveID",
    "typeOfLeave"."typeName",
    "leaveRequest"."startDate",
    "leaveRequest"."startTime",
    "leaveRequest"."endDate",
    "leaveRequest"."endTime",
    "leaveRequest"."attachedFile",
    "leaveRequest"."leaveDetail",
    'waitCancel' as "leaveStatus",
    "leaveRequest"."submittedTime"
FROM "cancelLeave"
INNER JOIN "leaveRequest" ON "leaveRequest"."leaveID" = "cancelLeave"."leaveID"
inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
inner join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
WHERE
    "leaveRequest"."username" = #{username}
    AND
    (
        "cancelLeave"."status" = 'pending'
    )
    AND "leaveStatus"."leaveStatus" = 'approved'
order by "submittedTime" desc
		]]>
	</select>
    
    
    
	<!-- Statement Load holiday list -->
	<select id="e87b9e7a-84b7-47a3-b797-a385240fa607" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select "eventName","eventDate" 
from "officialHoliday"
WHERE substring("eventDate",7,4) = #{year}
ORDER BY TO_DATE("eventDate", 'DD/MM/YYYY') ASC;
		]]>
	</select>
    
    
    
	<!-- Statement ๊Update Request Status -->
	<update id="ec7a98fb-e6e0-47be-ae7f-73001060a8b7" parameterType="java.util.HashMap">
		<![CDATA[
			update 
    "leaveStatus"
set 
    "leaveStatus" = #{status},
    "lastUpdated" = current_timestamp AT TIME ZONE 'Asia/Bangkok'
where "leaveID" = #{leaveID}
		]]>
	</update>
    
    
    
	<!-- Statement load all request -->
	<select id="09085575-1f10-4fb2-9d08-5265d218bd1d" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "attachedFile",
    "leaveStatus"."leaveStatus",
    "submittedTime",
    "user"."image"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" IN (
        SELECT "supervisee"
        FROM "empRelation"
        WHERE "supervisor" = #{username} AND "isActive" = 'true')
    AND
    "leaveRequest"."leaveID" NOT IN (
        SELECT "leaveID"
        FROM "cancelLeave"
        WHERE "status" = 'cancelled'
    )
order by 
    CASE 
        WHEN "leaveStatus"."leaveStatus" = 'pending' THEN 0 
        ELSE 1 
    END,
    TO_TIMESTAMP("submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc;

		]]>
	</select>
    
    
    
	<!-- Statement Load gender from username -->
	<select id="5beba84a-3643-419b-9e6f-60313a59bcf1" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select gender from public."user" where username = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Load drop down supervisees name -->
	<select id="8f6ac4cd-ab42-41a6-8e0b-a36df2eea590" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    "supervisee",
    "superviseeFullname"
FROM (
    SELECT DISTINCT
        "supervisee",
        "firstname" || ' ' || LEFT("lastname", 1) || '. (' || "nickname" || ')' AS "superviseeFullname",
        1 AS sort_order
    FROM "empRelation"
    INNER JOIN "user" ON "user"."username" = "empRelation"."supervisee"
    WHERE
        "supervisor" = #{username}
        AND
        "user"."isActive" = 'true'

    UNION

    SELECT
        'all' AS "supervisee",
        'All' AS "superviseeFullname",
        0 AS sort_order
) AS combined_result
ORDER BY sort_order, "supervisee"
		]]>
	</select>
    
    
    
	<!-- Statement type of leave male -->
	<select id="5d21af9d-4917-43eb-a2fb-75e8741e45dd" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "typeID", "typeName" FROM "typeOfLeave"
		]]>
	</select>
    
    
    
	<!-- Statement type of leave female -->
	<select id="8bf2fcb1-8b40-4f65-a69e-e77485f7ef16" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "typeID", "typeName" FROM "typeOfLeave" WHERE "typeID" <> 'LEAVE0004'
		]]>
	</select>
    
    
    
	<!-- Statement load remaining leaves -->
	<select id="8d825ac9-00f0-499b-a34f-21fad3163543" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
    "remainingDays" || ' days ' || "remainingHours" || ' hours' as "remainingLeaves"
from "remainingLeave"
where 
    "typeID" = #{leaveType}
    and
    "username" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement check in -->
	<insert id="6dad148f-8650-4322-b002-bdb9647735b2" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "checkInRecord" ("username", "checkIn_location", "checkIn_time")
VALUES (#{username}, #{checkIn_location},current_timestamp)
RETURNING id, TO_CHAR(current_timestamp, 'HH24:MI DD/MM/YYYY') AS "checkIn_time"
		]]>
	</insert>
    
    
    
	<!-- Statement TEST SQL STATEMENT -->
	<select id="ea2040c3-5397-404d-8b0a-c5177a8ca070" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select * from "user"
		]]>
	</select>
    
    
    
	<!-- Statement Load leave history_filter_status -->
	<select id="d3fb9262-2d95-4b31-b5cd-1f65623acf1d" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "attachedFile",
    "leaveDetail",
    "leaveStatus",
    "submittedTime"
from "leaveRequest"
inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
inner join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "username" = #{username}
    and
    "leaveStatus" = #{leaveStatus}
    and
    "leaveRequest"."leaveID" NOT IN (
        SELECT "leaveID"
        FROM "cancelLeave"
        WHERE "status" <> 'rejected'
    )

UNION

SELECT
    "cancelLeave"."leaveID",
    "typeOfLeave"."typeName",
    "leaveRequest"."startDate",
    "leaveRequest"."startTime",
    "leaveRequest"."endDate",
    "leaveRequest"."endTime",
    "leaveRequest"."attachedFile",
    "leaveRequest"."leaveDetail",
    'waitCancel' as "leaveStatus",
    "leaveRequest"."submittedTime"
FROM "cancelLeave"
INNER JOIN "leaveRequest" ON "leaveRequest"."leaveID" = "cancelLeave"."leaveID"
inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
inner join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
WHERE
    "leaveRequest"."username" = #{username}
    AND
    (
        "cancelLeave"."status" = 'pending'
    )
    AND #{leaveStatus} = 'approved'
order by "submittedTime" desc
		]]>
	</select>
    
    
    
	<!-- Statement load all request_t -->
	<select id="2277ee8b-5ea7-449c-a4f7-6becdeba232f" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "attachedFile",
    "leaveStatus"."leaveStatus",
    "submittedTime",
    "user"."image"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{username}
    AND
    "user"."isActive" = 'true'
    AND
    "leaveRequest"."leaveID" NOT IN (
        SELECT "leaveID"
        FROM "cancelLeave"
        WHERE "status" = 'cancelled'
        )
    AND
    "leaveRequest"."username" IN (
        SELECT "supervisee"
        FROM "empRelation"
        WHERE "supervisor" = #{supervisee} AND "isActive" = 'true'
    )
order by 
    TO_TIMESTAMP("submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc

		]]>
	</select>
    
    
    
	<!-- Statement Check haveCancelled -->
	<select id="ec5667fd-2967-4bb8-ada3-8df3b2d6fbe7" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select "leaveID" from "cancelLeave" where "leaveID" = #{leaveID}
		]]>
	</select>
    
    
    
	<!-- Statement Check Email_Forget Password -->
	<select id="145684e5-f0eb-4b8a-9613-e1c5a850dd86" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select * from "user" where "email" = #{email}
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty Sc0018 all 1 -->
	<select id="18eac3cf-4c93-4695-9cb2-591c439c3eee" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
            "leaveRequest"."leaveID",
            "typeOfLeave"."typeName",
            "startDate",
            "startTime",
            "endDate",
            "endTime",
            "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
            "leaveDetail",
            "leaveStatus"."leaveStatus",
            "submittedTime",
            "user"."image"
        from "leaveRequest"
        join "user" on "user"."username" = "leaveRequest"."username"
        join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
        join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
        where
            "leaveRequest"."username" IN (
                    SELECT "supervisee"
                    FROM "empRelation"
                    WHERE "supervisor" = #{username})
        order by "submittedTime"
		]]>
	</select>
    
    
    
	<!-- Statement Load holiday list -->
	<select id="d9c19709-a023-4319-85e5-040e0e483c7b" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select "eventName", "eventDate" from "officialHoliday"
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty sc0018 all sql -->
	<select id="ff808989-03a7-4292-910b-fd61240beb1e" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "leaveStatus"."leaveStatus",
    "submittedTime",
    "user"."image"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{supervisee}
order by "submittedTime"
		]]>
	</select>
    
    
    
	<!-- Statement Generate OTP and send Email_delete -->
	<delete id="5f8ee1ac-e20d-4708-99ae-b7d35b94474b" parameterType="java.util.HashMap">
		<![CDATA[
			DELETE FROM "pkg22_otp_template" 
WHERE TO_TIMESTAMP(SUBSTRING("created_at", 2, 20), 'YYYY-MM-DD"T"HH24:MI:SS.US') < CURRENT_DATE - INTERVAL '3 days';
		]]>
	</delete>
    
    
    
	<!-- Statement load all request_t_else -->
	<select id="d31b0d84-995d-4584-a2de-a4ff57ca356b" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "attachedFile",
    "leaveStatus"."leaveStatus",
    "submittedTime",
    "user"."image"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{supervisee}
    AND
    "user"."isActive" = 'true'
    AND
    "leaveRequest"."leaveID" NOT IN (
        SELECT "leaveID"
        FROM "cancelLeave"
        WHERE "status" = 'cancelled'
        )
order by 
    CASE 
        WHEN "leaveStatus"."leaveStatus" = 'pending' THEN 0 
        ELSE 1 
    END,
    TO_TIMESTAMP("submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc;
		]]>
	</select>
    
    
    
	<!-- Statement Generate OTP and send Email_insert -->
	<insert id="bb30d7b1-4523-4046-9234-a6d0f0c6ab7b" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "pkg22_otp_template" 
(
    "field_email",
    "template_refer",
    "template_otp",
    "created_at",
    "template_status"
)
VALUES (
    #{sendTo},
    #{refer},
    #{otp},
    current_timestamp AT TIME ZONE 'Asia/Bangkok',
    'ACTIVE'
)
		]]>
	</insert>
    
    
    
	<!-- Statement OTP Verification_select -->
	<select id="3d64d679-8299-47ca-8250-7774457832eb" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    "field_email",
    "template_refer",
    "template_otp",
    "created_at",
    "template_status"
FROM "pkg22_otp_template"
WHERE "template_refer" = #{refer}
		]]>
	</select>
    
    
    
	<!-- Statement Load filtered request_T -->
	<select id="59f1108f-77ee-4844-b314-8c5c949c2c3f" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
            "leaveRequest"."leaveID",
            "typeOfLeave"."typeName",
            "startDate",
            "startTime",
            "endDate",
            "endTime",
            "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
            "leaveDetail",
            "attachedFile",
            "leaveStatus"."leaveStatus",
            "submittedTime",
            "user"."image"
        from "leaveRequest"
        join "user" on "user"."username" = "leaveRequest"."username"
        join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
        join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
        where
            "leaveRequest"."username" IN (
                    SELECT "supervisee"
                    FROM "empRelation"
                    WHERE "supervisor" = #{username} AND "user"."isActive" = 'true')
            and
            "leaveStatus" = #{status}
            AND
            "leaveRequest"."leaveID" NOT IN (
                SELECT "leaveID"
                FROM "cancelLeave"
                WHERE "status" = 'cancelled'
            )
        order by
            TO_TIMESTAMP("submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement Load filtered request_T_else -->
	<select id="4c93d87c-445b-4ef2-bad9-a544916cb2d0" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "attachedFile",
    "leaveStatus"."leaveStatus",
    "submittedTime",
    "user"."image"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{supervisee}
    and 
    "leaveStatus" = #{status}
    AND
    "leaveRequest"."leaveID" NOT IN (
        SELECT "leaveID"
        FROM "cancelLeave"
        WHERE "status" = 'cancelled'
        )
order by
    TO_TIMESTAMP("submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty SC0028 all 1 -->
	<select id="22f22aac-1f2e-4733-a1c1-71a3b68f3640" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
            "cancelLeave"."leaveID",
            "typeOfLeave"."typeName",
            "startDate",
            "startTime",
            "endDate",
            "endTime",
            "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
            "leaveDetail",
            "leaveStatus"."leaveStatus",
            "cancelLeave"."submittedTime",
            "user"."image",
            "cancelLeave"."cancelDetail"
        from "leaveRequest"
        join "user" on "user"."username" = "leaveRequest"."username"
        join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
        join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
        join "cancelLeave" on "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
        where
            "leaveRequest"."username" IN (
                    SELECT "supervisee"
                    FROM "empRelation"
                    WHERE "supervisor" = #{username} AND "isActive" = 'true')
        order by TO_TIMESTAMP("cancelLeave"."submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty SC0028 all sql -->
	<select id="9065d2f7-2085-42a1-8bff-4bd77882f4af" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "cancelLeave"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "leaveStatus"."leaveStatus",
    "cancelLeave"."submittedTime",
    "user"."image",
    "cancelLeave"."cancelDetail"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
join "cancelLeave" on "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{supervisee}
    AND
    "user"."isActive" = 'true'
order by 
    TO_TIMESTAMP("cancelLeave"."submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement Get current year_Db_T -->
	<select id="d5c1b586-0521-4ecf-a9f8-a2cfb04c9c19" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT EXTRACT(YEAR FROM CURRENT_DATE) AS "current_year";
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty SC0028 filter 1 -->
	<select id="c77129be-7875-45c0-a73b-e4ff3f7c6d9f" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
            "cancelLeave"."leaveID",
            "typeOfLeave"."typeName",
            "startDate",
            "startTime",
            "endDate",
            "endTime",
            "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
            "leaveDetail",
            "leaveStatus"."leaveStatus",
            "cancelLeave"."submittedTime",
            "user"."image",
            "cancelLeave"."cancelDetail",
            "cancelLeave"."status" as "cancelStatus"
        from "leaveRequest"
        join "user" on "user"."username" = "leaveRequest"."username"
        join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
        join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
        join "cancelLeave" on "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
        where
            "leaveRequest"."username" IN (
                    SELECT "supervisee"
                    FROM "empRelation"
                    WHERE "supervisor" = #{username} AND "isActive" = 'true')
            AND
            "cancelLeave"."status" = #{status}
        order by TO_TIMESTAMP("cancelLeave"."submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty SC0028 filter sql -->
	<select id="28bab6b0-2c1e-4a71-b39f-6c52d88ca20c" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "cancelLeave"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "leaveStatus"."leaveStatus",
    "cancelLeave"."submittedTime",
    "user"."image",
    "cancelLeave"."cancelDetail",
    "cancelLeave"."status" as "cancelStatus"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
join "cancelLeave" on "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{supervisee}
    AND
    "user"."isActive" = 'true'
    AND
    "cancelLeave"."status" = #{status}
order by 
    TO_TIMESTAMP("cancelLeave"."submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement OTP Verification_update_expired -->
	<update id="6f256b3b-a65e-421c-bc28-47cbbaa32218" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE pkg22_otp_template
SET template_status = 'EXPIRED'
WHERE template_refer = #{refer}
		]]>
	</update>
    
    
    
	<!-- Statement Load cancellation all request 1 -->
	<select id="1e1ef1ff-94fe-49ee-87e9-dc0fab1909ab" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
            "cancelLeave"."leaveID",
            "typeOfLeave"."typeName",
            "startDate",
            "startTime",
            "endDate",
            "endTime",
            "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
            "leaveDetail",
            "attachedFile",
            "leaveStatus"."leaveStatus",
            "cancelLeave"."submittedTime",
            "user"."image",
            "cancelLeave"."cancelDetail",
            "cancelLeave"."status" as "cancelStatus"
        from "leaveRequest"
        join "user" on "user"."username" = "leaveRequest"."username"
        join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
        join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
        join "cancelLeave" on "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
        where
            "leaveRequest"."username" IN (
                    SELECT "supervisee"
                    FROM "empRelation"
                    WHERE "supervisor" = #{username} AND "isActive" = 'true')
        order by TO_TIMESTAMP("cancelLeave"."submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement Load cancellation all request sql -->
	<select id="5ca3e4b3-54ac-489f-b2f3-e745bd543f58" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "cancelLeave"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "attachedFile",
    "leaveStatus"."leaveStatus",
    "cancelLeave"."submittedTime",
    "user"."image",
    "cancelLeave"."cancelDetail",
    "cancelLeave"."status" as "cancelStatus"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
join "cancelLeave" on "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{supervisee}
    AND
    "user"."isActive" = 'true'
order by 
    TO_TIMESTAMP("cancelLeave"."submittedTime", 'YYYY-MM-DD HH24:MI:SS.US') desc
		]]>
	</select>
    
    
    
	<!-- Statement OTP Verification_update_verified -->
	<update id="17d02421-afbb-40ae-be76-88fe734ef792" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE pkg22_otp_template
SET template_status = 'VERIFIED'
WHERE template_refer = #{refer}
		]]>
	</update>
    
    
    
	<!-- Statement Update cancelled request 1 -->
	<update id="4ffb8216-1848-46f3-8749-7ee85691bc21" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "cancelLeave"
    SET
        "status" = #{status},
        "lastUpdated" = current_timestamp
    WHERE
        "leaveID" = #{leaveID}
    RETURNING
        "id"
		]]>
	</update>
    
    
    
	<!-- Statement Show employee list_New_SELECT -->
	<select id="ac3476a8-a022-4c6a-be55-faf9b4fd2514" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "firstname" || ' ' || "lastname" AS "fullname" 
FROM "user" 
WHERE "username" = #{supervisorUsername}
		]]>
	</select>
    
    
    
	<!-- Statement Reset password -->
	<update id="a8704da7-ca88-4510-890b-ec627935ff0b" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "user"
SET "password" = #{confirmNewPassword}
WHERE "email" = #{email}
		]]>
	</update>
    
    
    
	<!-- Statement Change password_READ -->
	<select id="f952f6e0-2df9-4d1a-b318-3050440e3410" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "username","password"
FROM "user"
WHERE "username" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Change password_UPDATE -->
	<update id="5b233ecd-a43d-46d0-8a24-c122ca781dae" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "user"
SET "password" = #{confirmNewPassword}
WHERE "username" = #{username}
		]]>
	</update>
    
    
    
	<!-- Statement Cancel request -->
	<insert id="cfc32690-8ba1-49d5-aa2f-0e14b7ca1e86" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "cancelLeave"
(
    "leaveID",
    "cancelDetail",
    "status",
    "submittedTime"
)
VALUES
(
    #{leaveID},
    #{cancelDetail},
    'pending',
    current_timestamp AT TIME ZONE 'Asia/Bangkok'
)
		]]>
	</insert>
    
    
    
	<!-- Statement Load home screen_field_inter_READ -->
	<select id="4446339d-6acd-46bf-9314-de6d60443638" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
    "firstname" || ' ' || "lastname" AS "fullname",
    "position",
    "remainingDays" || ' days '|| "remainingHours" || ' hours' AS "remaining",
    "image"
FROM "user"
INNER JOIN "remainingLeave" on "user"."username" = "remainingLeave"."username"
WHERE "user"."username" = #{username} AND "typeID" = 'LEAVE0001';
		]]>
	</select>
    
    
    
	<!-- Statement Load home screen tables_inter -->
	<select id="6df44676-3a05-4910-9975-27214437db05" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
        "typeOfLeave"."typeName",
        "leaveRequest"."startDate",
        "leaveRequest"."endDate",
        'Leave request' as "eventType"
    FROM "leaveRequest"
    INNER JOIN "typeOfLeave" ON "leaveRequest"."typeID" = "typeOfLeave"."typeID"
    INNER JOIN "leaveStatus" ON "leaveRequest"."leaveID" = "leaveStatus"."leaveID"
    WHERE 
        "leaveRequest"."username" = #{username}
        AND
        EXTRACT(month FROM TO_DATE("leaveRequest"."startDate", 'DD/MM/YYYY')) = EXTRACT(month FROM CURRENT_DATE)
        AND
        EXTRACT(year FROM TO_DATE("leaveRequest"."startDate", 'DD/MM/YYYY')) = EXTRACT(year FROM CURRENT_DATE)
        AND
        (
        "leaveStatus"."leaveStatus" != 'deleted' 
        AND 
        "leaveStatus"."leaveStatus" != 'rejected'
        )
        AND NOT EXISTS (
            SELECT 1
            FROM "cancelLeave"
            WHERE "cancelLeave"."leaveID" = "leaveRequest"."leaveID"
            AND "cancelLeave"."status" = 'cancelled'
        )
ORDER BY "startDate"
		]]>
	</select>
    
    
    
	<!-- Statement Update cancelled request 2 -->
	<update id="f1ada7d0-d619-468d-98d3-1095ed111aa5" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "cancelLeave"
    SET
        "status" = #{status},
        "lastUpdated" = current_timestamp
    WHERE
        "leaveID" = #{leaveID}
    RETURNING
        "id"
		]]>
	</update>
    
    
    
	<!-- Statement Submit comment DB_T -->
	<insert id="c0d16d3c-80d7-4506-9580-0e9df9c80f53" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "comment" ("comment","image","current_timestamp") VALUES (#{comment},#{image}, current_timestamp);
		]]>
	</insert>
    
    
    
	<!-- Statement calculateLeave_holidayList -->
	<select id="e10f50c4-800a-4ac1-863e-049fc8ad1c34" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "eventDate" FROM "officialHoliday"
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty SC0018 filter 1 -->
	<select id="a91553c0-6ed1-419a-a5cc-cd7e8db39e54" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
            "leaveRequest"."leaveID",
            "typeOfLeave"."typeName",
            "startDate",
            "startTime",
            "endDate",
            "endTime",
            "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
            "leaveDetail",
            "leaveStatus"."leaveStatus",
            "submittedTime",
            "user"."image"
        from "leaveRequest"
        join "user" on "user"."username" = "leaveRequest"."username"
        join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
        join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
        where
            "leaveRequest"."username" IN (
                    SELECT "supervisee"
                    FROM "empRelation"
                    WHERE "supervisor" = #{username})
            and
            "leaveStatus" = #{status}
        order by "submittedTime"
		]]>
	</select>
    
    
    
	<!-- Statement isEmpty sc0018 filter sql -->
	<select id="84211b45-273a-41a2-aa52-ad66620187f2" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select
    "leaveRequest"."leaveID",
    "typeOfLeave"."typeName",
    "startDate",
    "startTime",
    "endDate",
    "endTime",
    "user"."firstname" || ' ' || "user"."lastname" AS "fullname",
    "leaveDetail",
    "leaveStatus"."leaveStatus",
    "submittedTime",
    "user"."image"
from "leaveRequest"
join "user" on "user"."username" = "leaveRequest"."username"
join "typeOfLeave" on "typeOfLeave"."typeID" = "leaveRequest"."typeID"
join "leaveStatus" on "leaveStatus"."leaveID" = "leaveRequest"."leaveID"
where
    "leaveRequest"."username" = #{supervisee}
    and 
    "leaveStatus" = #{status}
order by "submittedTime"
		]]>
	</select>
    
    
    
	<!-- Statement Check exceeding request_getGender -->
	<select id="8e16c09f-f85e-4aac-a8f1-aacb7859dabe" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "gender" FROM "user" WHERE "username" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Check exceeding request_getRemaining -->
	<select id="8fe32797-6061-4bf8-bb8a-ccee86c6f46b" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
    "remainingDays",
    "remainingHours",
    "usedDays",
    "usedHours"
from "remainingLeave"
where 
    "username" = #{username}
    and
    "typeID" = #{leaveType}
		]]>
	</select>
    
    
    
	<!-- Statement Search latest leave request by username -->
	<select id="5c464c8e-1623-4db2-840d-05c8d06c101f" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
                "typeOfLeave"."typeName",
                "startDate" || ' ' || "startTime" as "from",
                "endDate" || ' ' || "startTime" as "to",
                "user"."firstname" || ' ' || "user"."lastname" || "user"."nickname"as "fullname",
                "leaveRequest"."leaveID",
                SUBSTRING("leaveRequest"."submittedTime", 1,19),
                "leaveRequest"."username",
                "leaveRequest"."leaveDetail"
            from "leaveRequest"
            inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
            inner join "user" on "user"."username" = "leaveRequest"."username"
            inner join "leaveStatus" on "leaveRequest"."leaveID" = "leaveStatus"."leaveID"
where "leaveRequest"."username" = #{username}
order by CAST("leaveRequest"."submittedTime" AS timestamp) DESC
limit 1
		]]>
	</select>
    
    
    
	<!-- Statement Get latest leave request By username -->
	<select id="3c71e7e6-c517-4475-a0f7-452c3a3ee548" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
                "typeOfLeave"."typeName",
                "startDate" || ' ' || "startTime" as "from",
                "endDate" || ' ' || "startTime" as "to",
                "user"."firstname" || ' ' || "user"."lastname" || "user"."nickname"as "fullname",
                "leaveRequest"."leaveID",
                SUBSTRING("leaveRequest"."submittedTime", 1,19) as "submittedTime",
                "leaveRequest"."username" as "usernameTo",
                "leaveRequest"."leaveDetail"
            from "leaveRequest"
            inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
            inner join "user" on "user"."username" = "leaveRequest"."username"
            inner join "leaveStatus" on "leaveRequest"."leaveID" = "leaveStatus"."leaveID"
where "leaveRequest"."username" = #{username}
order by CAST("leaveRequest"."submittedTime" AS timestamp) DESC
limit 1
		]]>
	</select>
    
    
    
	<!-- Statement Get latest leave request -->
	<select id="668986fc-3003-42a7-8098-323346cb227b" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			select 
                "typeOfLeave"."typeName",
                "startDate" || ' ' || "startTime" as "from",
                "endDate" || ' ' || "startTime" as "to",
                "user"."firstname" || ' ' || "user"."lastname" || "user"."nickname"as "fullname",
                "leaveRequest"."leaveID",
                SUBSTRING("leaveRequest"."submittedTime", 1,19),
                "leaveRequest"."username",
                "leaveRequest"."leaveDetail"
            from "leaveRequest"
            inner join "typeOfLeave" on "leaveRequest"."typeID" = "typeOfLeave"."typeID"
            inner join "user" on "user"."username" = "leaveRequest"."username"
            inner join "leaveStatus" on "leaveRequest"."leaveID" = "leaveStatus"."leaveID"
where "leaveRequest"."username" = #{username}
order by CAST("leaveRequest"."submittedTime" AS timestamp) DESC
limit 1
		]]>
	</select>
    
    
    
	<!-- Statement Search supervisor username -->
	<select id="0b010c7a-6bce-4f7c-a563-c85f5bb1fe03" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    "supervisor" as "supervisorusername"
FROM "empRelation"
WHERE "supervisee" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Search supervisor email -->
	<select id="23560408-68d5-4ab7-b25d-45b0762a30da" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    "email" as "supervisoremail"
FROM "user"
where "username" = #{supervisorusernametemp}
		]]>
	</select>
    
    
    
	<!-- Statement Show employee leaves_Get weekly filter_test -->
	<select id="b8ea9a18-ffd1-4f58-b12c-3d2f4b2c15fc" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
  TO_CHAR('2024-03-01'::date, 'MM/DD/YYYY') AS today,
  TO_CHAR(date_trunc('week', '2024-03-01'::date), 'MM/DD/YYYY') AS filterFrom,
  TO_CHAR(date_trunc('week', '2024-03-01'::date) + '4 days'::interval, 'MM/DD/YYYY') AS filterTo;

		]]>
	</select>
    
    
    
	<!-- Statement Show employee list V2.0 -->
	<select id="9524f650-9bc6-4221-a337-cb3f8bb0bf3b" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT * 
FROM
(
    SELECT
        CASE u."company"
            WHEN 'techberry' THEN 'TechBerry Co.,Ltd.'
            WHEN 'WDS' THEN 'WDS Co.,Ltd.'
            WHEN 'blueprint' THEN 'Blueprint Solutions Corporation Co.,Ltd.'
            WHEN 'BeeBuddy' THEN 'Beebuddy.Net Co.,Ltd.'
            WHEN 'napkin' THEN 'Napkin Co.,Ltd.'
            ELSE u."company"
        END AS "company",
        u."firstname" || ' ' || u."lastname" AS "fullname",
        u."firstname" || ' ' || u."lastname" || ' (' || COALESCE(u."nickname", '') || ')' AS "employeeFullname",
        u."position",
        u."nickname",
        u."email",
        u."birthdate",
        u."firstday",
        u."mobile",
        u."staffID",
        u."fullAddress",
        u."image",
        u."username",
        CASE WHEN cr."checkIn_time" IS NOT NULL THEN 'true' ELSE 'false' END AS "hasCheckIn",
        COALESCE(NULLIF(supervisor_user."firstname" || ' ' || supervisor_user."lastname",''),'-') AS "supervisorName"
    FROM"user" u
    JOIN
        "empRelation" er ON u.username = er.supervisee
    LEFT JOIN
        "checkInRecord" cr ON u.username = cr.username AND DATE(cr."checkIn_time") = CURRENT_DATE
    LEFT JOIN
    "user" supervisor_user ON er.supervisor = supervisor_user.username
    WHERE
        u."isActive" = 'true'
        AND (
            #{username} = '' OR
            u."username" = #{username}
        )
)
AS sub
ORDER BY
    ARRAY_POSITION(ARRAY['Wutichai Amornchaichan', 'Puttaporn Saengratanadej', 'Jon Vanasin', 'Verasak Jirathanakun', 'Tongsuk Buranarungruengkij'], "fullname") ASC,
    "fullname" ASC;

		]]>
	</select>
    
    
    
	<!-- Statement Get user's fullname -->
	<select id="2d1d4a84-9b14-4388-ae69-9f87273997b8" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    CONCAT("firstname",' ',"lastname",' (',"nickname",')') AS "fullname"
FROM "user"
WHERE "username" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Get type of leave name -->
	<select id="7a8f2707-dbe8-42e5-af54-8cf37605c285" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
    "typeName"
FROM "typeOfLeave"
WHERE "typeID" = #{typeID}
		]]>
	</select>
    
    
    
	<!-- Statement Insert checkIn -->
	<insert id="b66eb0d6-aeb4-4c46-b4c4-80d9c667c57f" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "checkInRecord" ("username", "checkIn_location", "checkIn_time", "checkIn_photo")
VALUES (#{username}, #{checkIn_location}, current_timestamp AT TIME ZONE 'Asia/Bangkok', #{newUrl})
		]]>
	</insert>
    
    
    
	<!-- Statement Show attendance -->
	<select id="b68a4ad8-c68b-48f6-806c-4ec16c49362d" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT * 
FROM "officeAttendance"
WHERE 
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') >= TO_DATE("dateStart", 'YYYY/MM/DD')) 
    AND
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') <= TO_DATE("dateEnd", 'YYYY/MM/DD'))
		]]>
	</select>
    
    
    
	<!-- Statement Update color office attendance -->
	<update id="fa531d9d-e2d9-4846-8828-b651169e7019" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "officeAttendance"
SET "color" = #{update_color}
WHERE 
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') >= TO_DATE("dateStart", 'YYYY/MM/DD')) 
    AND
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') <= TO_DATE("dateEnd", 'YYYY/MM/DD'))
		]]>
	</update>
    
    
    
	<!-- Statement Check attendance by date and username -->
	<select id="4aaebf47-eaf6-4e9f-bb81-00a67e42212b" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT * 
FROM "officeAttendance"
WHERE 
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') >= TO_DATE("dateStart", 'YYYY/MM/DD')) 
    AND
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') <= TO_DATE("dateEnd", 'YYYY/MM/DD'))
    AND
    "username" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Insert new officeAttendance -->
	<insert id="acfb5062-a094-46a3-a407-89fd47d0866f" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "officeAttendance"
(
    "username", "dateStart", "dateEnd"
)
VALUES
(
    #{username},#{input_date},#{input_date}
)
		]]>
	</insert>
    
    
    
	<!-- Statement Show attendances by date -->
	<select id="a7cbd069-f310-409c-bd2e-badd45c64511" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    u."username",
    u."firstname",
    u."lastname",
    '(' || u."nickname" || ')' AS "nickname",
    u."firstname" || ' ' || u."lastname" AS "fullname",
    u."image",
    oa."dateStart",
    oa."dateEnd",
    oa."color"
FROM 
    "user" u
JOIN 
    "officeAttendance" oa ON u."username" = oa."username"
WHERE 
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') >= TO_DATE("dateStart", 'YYYY/MM/DD')) 
    AND
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') <= TO_DATE("dateEnd", 'YYYY/MM/DD'))
ORDER BY "fullname" ASC
		]]>
	</select>
    
    
    
	<!-- Statement Show all attendances -->
	<select id="9ae051b5-6766-4bea-8cbf-f2b99bed2847" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    u."username",
    u."firstname",
    u."lastname",
    '(' || u."nickname" || ')' AS "nickname",
    u."firstname" || ' ' || u."lastname" AS "fullname",
    u."image",
    oa."dateStart",
    oa."dateEnd",
    oa."color"
FROM 
    "user" u
JOIN 
    "officeAttendance" oa ON u."username" = oa."username"
ORDER BY "fullname" ASC
		]]>
	</select>
    
    
    
	<!-- Statement Delete officeAttendance -->
	<delete id="e38afde3-30dc-4edc-9df2-f4135623f422" parameterType="java.util.HashMap">
		<![CDATA[
			DELETE FROM "officeAttendance"
WHERE 
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') >= TO_DATE("dateStart", 'YYYY/MM/DD')) 
    AND
    (TO_DATE(#{input_date}, 'YYYY/MM/DD') <= TO_DATE("dateEnd", 'YYYY/MM/DD'))
    AND
    "username" = #{username}
		]]>
	</delete>
    
    
    
	<!-- Statement Get usedDummy -->
	<select id="78f3c96d-48df-4e76-baae-687f2803055a" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT "usedDummy"
FROM "remainingLeave"
WHERE 
    "typeID" = #{leaveType}
    AND
    "username" = #{username}
		]]>
	</select>
    
    
    
	<!-- Statement Insert leaveRequest -->
	<insert id="f4af921d-f8d5-442c-b896-f64bde5d934a" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "leaveRequest"
(
    "username",
    "typeID",
    "startDate",
    "endDate",
    "startTime",
    "endTime",
    "leaveDetail",
    "submittedTime",
    "attachedFile"
)
VALUES
(
    #{username},
    #{leaveType},
    #{startDate},
    #{endDate},
    #{startTime},
    #{endTime},
    #{leaveDetail},
    current_timestamp AT TIME ZONE 'Asia/Bangkok',
    #{newURL}
)
RETURNING "id"
		]]>
	</insert>
    
    
    
	<!-- Statement Get leaveID -->
	<select id="8f0097f2-f613-4303-89df-693b8b6fbb26" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT CONCAT('LID', LPAD(CAST("id" AS VARCHAR), 6, '0')) AS leaveID,"id"
FROM "leaveRequest"
WHERE "id" = (SELECT CAST(MAX(CAST("id" AS INT)) AS VARCHAR) FROM "leaveRequest");

		]]>
	</select>
    
    
    
	<!-- Statement Update leaveID and calculated leave -->
	<update id="54b11a26-d66c-45fd-891d-499e32286f2f" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "leaveRequest"
SET 
    "leaveID" = #{leaveID},
    "leaveDays" = #{totalLeaveDays},
    "leaveHours" = #{totalLeaveHours}
WHERE "id" = #{id}
		]]>
	</update>
    
    
    
	<!-- Statement INSERT leaveStatus -->
	<insert id="3010d2c1-b1c9-4a30-a2b7-1a32f9091b8d" parameterType="java.util.HashMap">
		<![CDATA[
			INSERT INTO "leaveStatus"
(
    "leaveID",
    "leaveStatus",
    "lastUpdated"
)
VALUES
(
    #{leaveID},
    'pending',
    current_timestamp AT TIME ZONE 'Asia/Bangkok'
)
		]]>
	</insert>
    
    
    
	<!-- Statement UPDATE remainingLeave_singleUse -->
	<update id="151a393b-ecb9-49ef-a078-0b198509c883" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "remainingLeave"
  SET 
    "remainingDays" = #{remainingDays},
    "remainingHours" = #{remainingHours},
    "usedDays" = #{usedDays1},
    "usedHours" = #{usedHours1},
    "usedDummy" = 'yes'
  WHERE
    "username" = #{username}
    AND
    "typeID" = #{leaveType}
		]]>
	</update>
    
    
    
	<!-- Statement UPDATE remainingLeave -->
	<update id="33acc3cf-7e3d-493d-ad0b-14f28cc5f2b2" parameterType="java.util.HashMap">
		<![CDATA[
			UPDATE "remainingLeave"
  SET 
    "remainingDays" = #{remainingDays},
    "remainingHours" = #{remainingHours},
    "usedDays" = #{usedDays1},
    "usedHours" = #{usedHours1}
  WHERE
    "username" = #{username}
    AND
    "typeID" = #{leaveType}
		]]>
	</update>
    
    
    
	<!-- Statement Show checkIn Summary_table_currentDate -->
	<select id="899b4f29-a9c2-442c-a0cc-3db13821da27" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT * FROM (
    SELECT 
        CONCAT("user"."firstname",' ', LEFT("user"."lastname", 3), '.') AS "fullname",
        '' AS "status",
        TO_CHAR(TO_TIMESTAMP("checkIn_time", 'YYYY-MM-DD HH24:MI:SS.US'), 'HH24:MI:SS') AS "checkinTime",
        'true' AS "checkIn"
    FROM "checkInRecord"
    INNER JOIN "user" ON "checkInRecord"."username" = "user"."username"
    WHERE DATE("checkIn_time") = CURRENT_DATE
    UNION ALL
    SELECT 
        CONCAT("firstname", ' ', LEFT("lastname", 3), '.') AS "fullname",
        '' AS "status",
        '-' AS "checkinTime",
        'false' AS "checkIn"
    FROM "user"
    WHERE "username" NOT IN (
        SELECT "username"
        FROM "checkInRecord"
        WHERE DATE("checkIn_time") = CURRENT_DATE
    ) 
    AND "isActive" = 'true'
) AS combined_result
ORDER BY 
    CASE WHEN "checkinTime" = '-' THEN "fullname" ELSE "checkinTime" END ASC NULLS LAST;

		]]>
	</select>
    
    
    
	<!-- Statement Show checkIn Summary_table_customDate -->
	<select id="940b638f-69dc-41a9-b243-8e95ad4e73b2" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT * FROM (
    SELECT 
        CONCAT("user"."firstname",' ', LEFT("user"."lastname", 3), '.') AS "fullname",
        '' AS "status",
        TO_CHAR(TO_TIMESTAMP("checkIn_time", 'YYYY-MM-DD HH24:MI:SS.US'), 'HH24:MI:SS') AS "checkinTime",
        'true' AS "checkIn"
    FROM "checkInRecord"
    INNER JOIN "user" ON "checkInRecord"."username" = "user"."username"
    WHERE DATE("checkIn_time") = TO_DATE(#{selectDate},'DD/MM/YYYY')
    UNION ALL
    SELECT 
        CONCAT("firstname", ' ', LEFT("lastname", 3), '.') AS "fullname",
        '' AS "status",
        '-' AS "checkinTime",
        'false' AS "checkIn"
    FROM "user"
    WHERE "username" NOT IN (
        SELECT "username"
        FROM "checkInRecord"
        WHERE DATE("checkIn_time") = TO_DATE(#{selectDate},'DD/MM/YYYY')
    )
    AND
    "isActive" = 'true'
) AS combined_result
ORDER BY 
    CASE WHEN "checkinTime" = '-' THEN "fullname" ELSE "checkinTime" END ASC NULLS LAST;

		]]>
	</select>
    
    
    
	<!-- Statement Show checkIn Summary_fields_currentDate -->
	<select id="1a550838-cc36-4d5f-bd97-9e373ae37e3d" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
    (SELECT COUNT(*) 
     FROM (
         SELECT 
             CONCAT("user"."firstname",' ', LEFT("user"."lastname", 3), '.') AS "fullname",
             '' AS "status",
             TO_CHAR(TO_TIMESTAMP("checkIn_time", 'YYYY-MM-DD HH24:MI:SS.US'), 'HH24:MI:SS') AS "checkIn_time"
         FROM "checkInRecord"
         INNER JOIN "user" ON "checkInRecord"."username" = "user"."username"
         WHERE DATE("checkIn_time") = CURRENT_DATE
     ) AS count_from_first_query
    ) AS number_haveCheckIn,
    (SELECT COUNT(*)
     FROM (
         SELECT 
             CONCAT("firstname", ' ', LEFT("lastname", 3), '.') AS "fullname"
         FROM "user"
         WHERE "username" NOT IN (
             SELECT "username"
             FROM "checkInRecord"
             WHERE DATE("checkIn_time") = CURRENT_DATE
         )
        AND
        "isActive" = 'true'
     ) AS subquery
    ) AS number_notCheckIn;

		]]>
	</select>
    
    
    
	<!-- Statement Show checkIn Summary_fields_customDate -->
	<select id="de6d77d4-deaa-40ce-a141-076e0c30b6d2" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT 
    (SELECT COUNT(*) 
     FROM (
         SELECT 
             CONCAT("user"."firstname",' ', LEFT("user"."lastname", 3), '.') AS "fullname",
             '' AS "status",
             TO_CHAR(TO_TIMESTAMP("checkIn_time", 'YYYY-MM-DD HH24:MI:SS.US'), 'HH24:MI:SS') AS "checkIn_time"
         FROM "checkInRecord"
         INNER JOIN "user" ON "checkInRecord"."username" = "user"."username"
         WHERE DATE("checkIn_time") = TO_DATE(#{selectDate},'DD/MM/YYYY')
     ) AS count_from_first_query
    ) AS number_haveCheckIn,
    (SELECT COUNT(*)
     FROM (
         SELECT 
             CONCAT("firstname", ' ', LEFT("lastname", 3), '.') AS "fullname"
         FROM "user"
         WHERE "username" NOT IN (
             SELECT "username"
             FROM "checkInRecord"
             WHERE DATE("checkIn_time") = TO_DATE(#{selectDate},'DD/MM/YYYY')
         )
         AND "isActive" = 'true'
     ) AS subquery
    ) AS number_notCheckIn;

		]]>
	</select>
    
    
    
	<!-- Statement search email from supervisorusername -->
	<select id="dc978e9d-759e-4fc9-b049-9c79576e4c66" resultType="java.util.Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT
    "email" as "supervisoremail"
FROM "user"
where "username" = #{supervisorusername}
		]]>
	</select>
    
    

</mapper>